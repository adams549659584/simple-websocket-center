# nest框架结合RabbitMQ实现即时通讯—系统课程大纲

## 实验1 框架介绍以及系统需求分析

### 实验介绍

#### 知识点

* vue、vant框架介绍（前端）
* nest、RabbitMQ（后端）
* docker用法
* 系统功能拆分

#### 实验基础

系统： Linux；内存 大于 2G

#### 实验内容

* 熟悉vue、vant、nest的编方式（不做详细示例）
* RabbitMQ的发布订阅模式
* 系统功能拆分
* docker安装（实验环境中已具备），熟悉常用指令

### 实验总结

需要开发者对系统中采用的技术栈有大致的了解，对系统将要实现的功能有清晰的印象。

## 实验2 前后端项目环境搭建

### 实验介绍

#### 知识点

* node、npm安装
* vue脚手架创建前端项目
* nest脚手架创建后端项目
* 如何采用docker方式安装redis，mongoDb，mysql，RabbitMQ
* Navicat Premium(数据库连接工具)，postman（接口测试工具）

#### 实验基础

系统： Linux；内存 大于 2G

#### 实验内容

* nod安装
* redis，mongoDb，mysql，RabbitMQ安装
* simple-chart-web项目搭建
* simple-user-center，simple-im-push-center，simple-websocket-center项目搭建
* postman测试第一个接口
* Navicat Premium连接数据库
* 系统功能拆分

### 实验总结

需要开发者搭建好系统所需要的全部的环境，并且创建好前后端项目模板；熟练掌握使用postman测试接口。

## 实验3 用户登录注册功能开发

### 实验介绍

#### 知识点

* nest框架中如何设计实体
* nest编写RESTful接口，postman测试用户相关接口
* vant如何快速编写前端页面

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis

#### 实验内容

* 用户实体编写
* 了解JWT 鉴权机制
* 用户CRDU 接口编写并完成测试
* vant快速完成布局（登录，首页）
* 用户前后端接口联调

### 实验总结

需要开发者习惯nest的编码习惯并顺利完成simple-user-center最基本的接口开发，熟练掌握vant的布局方式完成系统登录和首页的开发并完成与后端接口的联调。

## 实验4 好友关系模块开发

### 实验介绍

#### 知识点

* 用户关系如何维护好友关系
* RabbitMQ消息队列在node中如何使用
* 深入了解RabbitMQ的发布订阅模式

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 用户关系关联产生好友关系
* 系统集成websocket
* 系统集成redis
* 系统集成RabbitMQ消息队列
* RabbitMQ解耦系统实现用户搜索，发送添加请求，用户同意流程
* 接口测试
* 好友列表，我的请求，好友搜索组件开发
* 接口联调，添加好友模块黑盒测试

### 实验总结

需要开发者熟练掌握RabbitMQ发布消息，订阅消息；成好友关系维护的相关代码逻辑。

## 实验4 好友单聊功能设计

### 实验介绍

#### 知识点

* RabbitMQ扩散消息
* nest中如何使用event解耦模块，降低各service间依赖
* 深入了解RabbitMQ的发布订阅模式
* 客户端如何发送websocket消息到服务端
* 单聊消息持久化

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 用户关系关联产生好友关系
* 点对点聊天消息持久化
* 聊天室组件开发
* 实现客户端和服务端通信
* 服务端利用RabbitMQ转发消息，消费者订阅消息实现好友间通信
* 接口联调，添加好友模块黑盒测试

### 实验总结

利用websocket实现好友间即时聊天

## 实验5 客户端数据同步功能设计

### 实验介绍

#### 知识点

* 聊天消息复杂查询及过滤
* 发布订阅模式在前端领域中的应用场景
* vue中keepalive的使用场景

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 客户端首页最新消息接口开发（好友）
* 客户端监听服务端单聊消息
* 客户端采用发布订阅同步首页列表数据

### 实验总结

通过发布订阅实现客户端各模块间信息共享，同步更新

## 实验6 群关系维护（一）

### 实验介绍

#### 知识点

* 用户，好友，群组关系
* 群组创建，群成员维护

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 群组特征属性分析
* 群组实体创建
* 群组CRDU接口开发
* postman测试接口

### 实验总结

通过发布订阅实现客户端各模块间信息共享，同步更新

## 实验7 群关系维护（二）

### 实验介绍

#### 知识点

* 用户如何加入已经创建好的群组
* 群主，管理员对入群申请如何批复
* redis分布式锁是如何运行的

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 用户入群，管理者批复申请相关逻辑实现
* 客户端群组列表，添加群组组件开发
* 了解redis分布式锁的工作原理

### 实验总结

完成群关系的相关接口，前端完成相关页面并完成接口联调。时间充足的情况下可以采用分布式锁实现对入群申请批复逻辑进行优化。

## 实验8 群聊功能设计（一）

### 实验介绍

#### 知识点

* 群聊消息如何存储
* 群聊消息如如扩散

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 群消息扩散机制设计
* postman测试群聊扩散机制

### 实验总结

了解群消息扩散的机制

## 实验8 群聊功能设计（二）

### 实验介绍

#### 知识点

* 群聊模块接口开发
* 群聊房间组件开发

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 群聊房间组件开发
* 群消息扩散，群消息持久化逻辑代码编写
* 黑盒测试群聊功能

### 实验总结

了解群的实现逻辑。

## 实验9 智能AI闲聊功能设计

### 实验介绍

#### 知识点

* 什么是UNIT
* UNIT的现状
* 如何快速实现一个AI闲聊机器人

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 了解百度UNIT
* 基于百度UNIT完成智能对话接口
* 智能闲聊助手聊天室组件开发
* AI闲聊功能进行黑盒测试

### 实验总结

开发者可以基于百度的智能对话系统快速搭建出基于深度学习的闲聊系统。

## 实验10 系统压力测试

### 实验介绍

#### 知识点

* jmeter了解
* postman如何进行压力测试

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* 了解postman高级应用
* 采用postman对系统进行压力测试

### 实验总结

了解压力测试的重要性，完成聊天系统的压力测试用例

## 实验11 docker镜像构建

### 实验介绍

#### 知识点

* docker 如何打包镜像
* docker push 镜像
* node项目镜像过大如何优化
* node项目如何打包成单文件

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ

#### 实验内容

* docker build 镜像
* docker push 镜像
* ncc 打包simple-user-center项目
* 四个服务工程（前端1 + 后端3）全部完成容器化

### 实验总结

了解压力测试的重要性，完成聊天系统的压力测试用例

## 实验12 docker部署系统

### 实验介绍

#### 知识点

* 什么是docker-compose
* docker-compose如何一键部署应用

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ， docker-compose

#### 实验内容

* docker-compose部署即时聊天项目

### 实验总结

使用docker-compose完成部署系统

## 实验12 使用k3s对容器进行管理

### 实验介绍

#### 知识点

* 什么是k3s
* k3s安装
* k3s如何部署，升级，回滚应用

#### 实验基础

系统： Linux；内存 大于 2G ; 环境：mongodb redis， RabbitMQ， docker-compose

#### 实验内容

* k3s离线安装
* k3s简单命令熟悉
* k3s完成测试应用部署

### 实验总结

熟悉k3s的使用，熟练掌握使用k3s部署应用
